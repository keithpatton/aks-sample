# pvcs 
{{- $groups := list }}
{{- range $.Values.tenants }}
  {{- if not (has .group $groups) }}
  {{- $groups = append $groups .group}}
  {{- end }}
{{- end }}

# pvc per namespaced tenant group 
{{- range $groups }}
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ $.Values.aksPvcName }}
  namespace: {{ $.Values.appName }}-{{ . }}
spec:
  accessModes:
  - ReadWriteOnce
  storageClassName: {{ $.Values.aksStorageClassNamePrefix }}common
  resources:
    requests:
      storage: 5Gi
---
{{- end }}

# pvc for each tenant per namespaced tenant group 
{{- range $.Values.tenants }}
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ $.Values.aksPvcName }}-{{ .name }}
  namespace: {{ $.Values.appName }}-{{ .group }}
spec:
  accessModes:
  - ReadWriteOnce
  storageClassName: {{ $.Values.aksStorageClassNamePrefix }}{{ .name}}
  resources:
    requests:
      storage: 5Gi
---
{{- end }}